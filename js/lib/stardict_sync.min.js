!function(n){function r(n,r){0>r&&(r=n.length+r),out=0;for(var t=r;r+4>t;t++)out<<=8,out|=255&n[t];return out}function e(n,r,t){if("undefined"==typeof r&&(r=0),"undefined"==typeof t&&(t=-1),".dz"==n.name.substr(-3)){var e=new DictZipFile(n,pako.inflateRaw);return t>=0?e.read(r,t):e.read(r)}var e=new FileReaderSync;return e.readAsArrayBuffer(t>=0?n.slice(r,r+t):n.slice(r))}function i(n,r,t){var i=e(n,r,t);return u(new Uint8Array(i))}const o=25;var u=function(){var n=new TextDecoder("utf-8");return function(r){return n.decode(r)}}(),f=function(){var n=function(n){function f(n){if(["idx","idx.oft","syn","syn.oft","dict","ifo","rifo","ridx","rdic"].forEach(function(r){c[r]=null;for(var t=0;t<n.length;t++){var e=n[t].name;(e.substr(-1-r.length)=="."+r||e.substr(-4-r.length)=="."+r+".dz")&&(c[r]=n[t],n.splice(t,1))}}),c.res=n,null==c.dict)throw new Error("Missing *.dict(.dz) file!");if(null==c.idx)throw new Error("Missing *.idx(.dz) file!");if(null==c.ifo)throw new Error("Missing *.ifo(.dz) file!")}function s(n){var r=n.split("\n");if("StarDict's dict ifo file"!=r.shift())throw new Error("Not a proper ifo file");r.forEach(function(n){w=n.split("="),l[w[0]]=w[1]})}function a(n){var r=n.split("\n");if("StarDict's storage ifo file"!=r.shift())throw new Error("Not a proper rifo file");r.forEach(function(n){w=n.split("="),console.log("rifo: "+w[0]+"="+w[1])})}var c={},l={version:"",bookname:"",wordcount:"",synwordcount:"0",idxfilesize:"",sametypesequence:""};f(n),s(i(c.ifo)),null!=c.rifo&&a(i(c.rifo)),this.keyword=function(n){return l[n]},this.resource=function(n){function t(){for(var r=0;r<c.res.length;r++){var t=c.res[r].name;if(n==t.substring(t.lastIndexOf("/")+1))return c.res[r]}return null}function i(t){for(var e=new Uint8Array(t),i=0,o=0;i<e.length;i++)if(u(e.subarray(o,i))==n)return[r(e,i+1),r(e,i+5)];return null}n=n.replace(/^\x1E/,"").replace(/\x1F$/,"");var o=t();if(null!=o)return o;if(null==c.ridx)return null;var f=i(e(c.ridx));return null!=f?new Blob([e(c.rdic,f[0],f[1])]):void 0},this.entry=function(n){function r(n){var r=new Uint8Array(n),e=[],i=!1;for(""!=l.sametypesequence&&(type_str=l.sametypesequence,i=!0);;){if(i?(t=type_str[0],type_str=type_str.substr(1)):(t=String.fromCharCode(r[0]),r=r.subarray(1)),i&&""==type_str)d=r;else if(t==t.toUpperCase()){var o=getUIntAt(r,0);d=r.subarray(4,o+4),r=r.subarray(o+4)}else{for(var o=0;0!=r[o];)o++;d=r.subarray(0,o),r=r.subarray(o+1)}if(-1!="mgtxykwh".indexOf(t)&&(d=u(d)),e.push({type:t,content:d}),0==r.length||i&&""==type_str)break}return e}var i=n[0],o=n[1];return r(e(c.dict,i,o))},this.synonyms=function(n){function t(t,e){var i={};return n.include_term&&(i.term=u(t.subarray(0,-5))),n.include_wid&&(i.wid=r(t,-4)),n.include_offset&&(i.offset=e),i}function i(n,r,u){if("undefined"==typeof u&&(u=o),0>=r||c.syn.size<=n)return[];for(var f=r*u,s=e(c.syn,n,f),a=new Uint8Array(s),d=[],l=0,y=0;y<a.length-4&&r>d.length;y++)0==a[y]&&(d.push(t(a.subarray(l,y+5),n+l)),y+=5,l=y);return d.concat(i(n+l,r-d.length,u+o))}if(null==c.syn)return[];"undefined"==typeof n&&(n={});var f={count:-1,start_offset:0,include_term:!0,include_wid:!0,include_offset:!1};for(var s in f)"undefined"==typeof n[s]&&("count"==s&&"undefined"!=typeof n.start_offset?n.count=1:n[s]=f[s]);return n.count<0&&(n.count=parseInt(this.keyword("synwordcount"))),i(n.start_offset,n.count)},this.index=function(n){function t(t,e){var i={};return n.include_term&&(i.term=u(t.subarray(0,-9))),n.include_dictpos&&(i.dictpos=[r(t,-8),r(t,-4)]),n.include_offset&&(i.offset=e),i}function i(n,r,u){if("undefined"==typeof u&&(u=o),0>=r||c.idx.size<=n)return[];for(var f=r*u,s=e(c.idx,n,f),a=new Uint8Array(s),d=[],l=0,y=0;y<a.length-8&&r>d.length;y++)0==a[y]&&(d.push(t(a.subarray(l,y+9),n+l)),y+=9,l=y);return d.concat(i(n+l,r-d.length,u+o))}"undefined"==typeof n&&(n={});var f={count:-1,start_offset:0,include_term:!0,include_dictpos:!0,include_offset:!1};for(var s in f)"undefined"==typeof n[s]&&("count"==s&&"undefined"!=typeof n.start_offset?n.count=1:n[s]=f[s]);n.count<0&&(n.count=parseInt(this.keyword("wordcount")));return i(n.start_offset,n.count)},this.oft=function(n){"undefined"==typeof n&&(n="index");var r,t=("synonyms"==n?"syn":"idx")+".oft",i=parseInt(this.keyword(("synonyms"==n?"syn":"")+"wordcount"));if(null==c[t]){for(var o=this.iterable(n),u=o.next(),f=0,s=new Uint32Array(i);null!=u;)s[f++]=u,u=o.next();r=s.buffer}else r=e(c[t]);return r},this.iterable=function(n){"undefined"==typeof n&&(n="index");var t,i=function(t){return new function(){function e(n){for(var r=n;r<t.length;r++)if(0==t[r])return r;return-1}var i=0;this.data=function(i){return"synonyms"==n?r(t,e(i)+1):[r(t,e(i)+1),r(t,e(i)+5)]},this.term=function(n){return u(t.subarray(n,e(n)))},this.next=function(){for(var r=i,e=null,o="synonyms"==n?4:8;i<t.length;i++)if(0==t[i]){e=r,i+=o+1;break}return e},this.view=t}},o="synonyms"==n?"syn":"idx";return null==c[o]?i([]):(t=e(c[o]),i(new Uint8Array(t)))}};return n}();n.StarDict=f}(this);
